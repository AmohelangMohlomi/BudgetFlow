<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard | BudgetFlow</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
</head>
<body>

    <!-- Navbar -->
    <div class="navbar">
        <h1>BudgetFlow</h1>
        <nav>
            <a href="/">Home</a>
            <a href="/budget">Budget</a>
            <a href="/add-expense">Add Expense</a>
            <a href="/penny">Talk to Penny</a>
            <a href="/settings">Settings</a>
        </nav>
    </div>

    <div class="card">
        <h2>Welcome back{{ ', ' + session['username'] if 'username' in session else '' }} ðŸ‘‹</h2>
        <p>Here's a snapshot of your financial activity.</p>
    </div>

    
        <div class="card graph-container">
            <h3>Budget vs Spending by Category</h3>
            <canvas
                id="budgetVsSpendingChart"
                data-categories='{{ categories | tojson }}'
                data-budgets='{{ budgets | tojson }}'
                data-spent='{{ spent | tojson }}'>
            </canvas>
        </div>

        <div class="card">
        <h2>Your Expenses</h2>

    {% if expenses %}
    <table class="expenses-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Category</th>
                <th>Description</th>
                <th>Amount (R)</th>
            </tr>
        </thead>
        <tbody>
            {% for expense in expenses %}
            <tr>
                <td>{{ expense['date'] }}</td>
                <td>{{ expense['category'] }}</td>
                <td>{{ expense['description'] or "-" }}</td>
                <td>{{ expense['amount'] }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>You haven't added any expenses yet.</p>
        {% endif %}

    


    <div class="penny-advice">
        Youâ€™ve been doing well this month! Try reducing your entertainment budget by 10% next week.
    </div>

    <!-- Quick Action Buttons -->
    <div style="text-align: center; margin: 2rem 0;">
        <a href="/add-expense" class="btn">Add Expense</a>
        <a href="/budget" class="btn btn-warning">View Budget</a>
        <a href="/penny" class="btn btn-danger">Talk to Penny</a>
    </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="flash-message {{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
        {% endwith %}
        {% if over_budget_alerts %}
<div class="card alert-card" style="background-color: #f8d7da; color: #721c24; padding: 1rem; border-radius: 5px; margin-bottom: 1rem;">
    <h3>Budget Alerts</h3>
    <ul>
        {% for alert in over_budget_alerts %}
        <li>
            You are over budget in <strong>{{ alert.category }}</strong> by R{{ "%.2f"|format(alert.difference) }} (Budgeted: R{{ "%.2f"|format(alert.budgeted) }}, Spent: R{{ "%.2f"|format(alert.spent) }}).
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}


          <footer>
        <p>&copy; 2025 BudgetFlow</p>
    </footer>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
